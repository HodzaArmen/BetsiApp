@page
@model BetsiApp.Pages.FootballModel
@{
    ViewData["Title"] = "Nogometne stave";
}

<div class="text-center">
    <h1 class="text-center mt-6 fw-semibold mb-4">⚽ Nogometne Tekme ⚽</h1>
</div>

<form method="get" class="d-flex justify-content-center mb-3">
    <div style="max-width: 360px;" class="w-100">
        <select name="Competition" class="form-select" onchange="this.form.submit()">
            <option value="">Vsa tekmovanja</option>
            @foreach (var c in Model.CompetitionOptions)
            {
                <option value="@c" selected="@(Model.Competition == c)">
                    @c
                </option>
            }
        </select>
    </div>
</form>

@if (TempData["StatusMessage"] != null)
{
    <div class="alert alert-success text-center">
        @TempData["StatusMessage"]
    </div>
}

@*Miha v sredo 3. verzija*@
@if (Model.UpcomingMatches.Any())
{
    <table class="table table-striped align-middle">
        <thead class="table-dark">
            <tr>
                <th style="width:14%;">Tekmovanje</th>
                <th style="width:14%;">Datum / Ura</th>
                <th style="width:30%;">Tekma</th>
                <th style="width:10%;">Rezultat</th>
                <th style="width:12%;" class="text-center">Znesek (€)</th>
                <th style="width:6%;" class="text-center">1</th>
                <th style="width:6%;" class="text-center">X</th>
                <th style="width:6%;" class="text-center">2</th>
            </tr>
        </thead>

        <tbody>
        @foreach (var match in Model.UpcomingMatches)
        {
            Random rnd = new Random(match.Id);
            decimal odd1 = (decimal)(rnd.NextDouble() * (3.0 - 1.2) + 1.2);
            decimal oddX = (decimal)(rnd.NextDouble() * (4.5 - 2.8) + 2.8);
            decimal odd2 = (decimal)(rnd.NextDouble() * (4.0 - 1.5) + 1.5);

            <tr>
                <td><strong>@match.Competition?.Name</strong></td>

                <td>@match.UtcDate.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>

                <td>
                    <strong>@match.HomeTeam?.Name</strong> vs
                    <strong>@match.AwayTeam?.Name</strong>
                </td>

                <td>
                    @if (match.Score?.FullTime?.Home.HasValue ?? false)
                    {
                        <span>@match.Score.FullTime.Home : @match.Score.FullTime.Away</span>
                    }
                    else
                    {
                        <span>-</span>
                    }
                </td>

                <form method="post" asp-page-handler="PlaceBet">
                    <input type="hidden" name="matchId" value="@match.Id" />
                    <input type="hidden" name="homeTeam" value="@match.HomeTeam?.Name" />
                    <input type="hidden" name="awayTeam" value="@match.AwayTeam?.Name" />
                    <input type="hidden" name="oddValue" id="odd-@match.Id" />
                    <input type="hidden" name="selectedOutcome" id="outcome-@match.Id" />

                    <td class="text-center">
                        <input type="number"
                            name="stake"
                            class="form-control form-control-sm text-center"
                            value="0" min="1" style="width:80px; margin:auto;" />
                    </td>

                    <td class="text-center">
                        <button type="submit"
                                class="btn btn-outline-primary w-100"
                                onclick="setBet('@match.Id','1','@odd1')">
                            @odd1.ToString("F2")
                        </button>
                    </td>

                    <td class="text-center">
                        <button type="submit"
                                class="btn btn-outline-secondary w-100"
                                onclick="setBet('@match.Id','X','@oddX')">
                            @oddX.ToString("F2")
                        </button>
                    </td>

                    <td class="text-center">
                        <button type="submit"
                                class="btn btn-outline-danger w-100"
                                onclick="setBet('@match.Id','2','@odd2')">
                            @odd2.ToString("F2")
                        </button>
                    </td>
                </form>
            </tr>
        }
        </tbody>
    </table>
}
else
{
    <div class="alert alert-warning">
        Trenutno ni podatkov o tekmah.
    </div>
}
<script>
    function setBet(matchId, outcome, odd) {
        document.getElementById('outcome-' + matchId).value = outcome;
        document.getElementById('odd-' + matchId).value = odd;
    }
</script>










@* Druga verzija
@if (Model.UpcomingMatches.Any())
{
    <table class="table table-striped">
        <thead class="thead-dark">
            <tr>
                <th>Tekmovanje</th> <th>Runda</th>       <th>Datum/Ura</th>
                <th>Domača Ekipa</th>
                <th>Gostujoča Ekipa</th>
                <th>Rezultat</th>
                <th>Stadion</th>     </tr>
        </thead>
        <tbody>
            @foreach (var match in Model.UpcomingMatches)
            {
                <tr>
                    <td>
                        <strong>@match.Competition?.Name</strong>
                    </td>
                    <td>
                        @if (match.Matchday.HasValue)
                        {
                            <span>Runda: @match.Matchday.Value</span>
                        }
                    </td>
                    <td>@match.UtcDate.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                    <td>
                        <strong>@match.HomeTeam?.Name</strong>
                    </td>
                    <td>
                        <strong>@match.AwayTeam?.Name</strong>
                    </td>
                    <td>
                        @{
                            if (match.Score?.FullTime?.Home.HasValue ?? false)
                            {
                                <span>@match.Score.FullTime.Home : @match.Score.FullTime.Away</span>
                            }
                            else
                            {
                                <span>-</span>
                            }
                        }
                    </td>
                    <td>
                        @if (!string.IsNullOrEmpty(match.Venue))
                        {
                            <span>@match.Venue</span>
                        }
                        else
                        {
                            <span>N/A</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <div class="alert alert-warning">
        Trenutno ni podatkov o tekmah.
    </div>
}
*@








@*Prva verzija*@
@*@page
@model BetsiApp.Pages.FootballModel

<h1 class="text-center mt-3">Nogometne Tekme ⚽</h1>

<table class="table table-striped mt-4">
    <thead>
        <tr>
            <th>Liga</th>
            <th>Runda</th>
            <th>Datum</th>
            <th>Domača ekipa</th>
            <th>Gostujoča ekipa</th>
            <th>Rezultat</th>
            <th>Stadion</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var m in Model.UpcomingMatches)
        {
            <tr>
                <td><strong>@m.Competition?.Name</strong></td>
                <td>@m.Matchday</td>
                <td>@m.UtcDate.ToLocalTime()</td>
                <td>@m.HomeTeam?.Name</td>
                <td>@m.AwayTeam?.Name</td>
                <td>
                    @(
                        m.Score?.FullTime?.Home.HasValue == true
                        ? $"{m.Score.FullTime.Home} : {m.Score.FullTime.Away}"
                        : "-"
                    )
                </td>
                <td>@(m.Venue ?? "N/A")</td>
            </tr>
        }
    </tbody>
</table> *@
