@page
@model BetsiApp.Pages.BasketballModel

<h1 class="text-center mt-6 fw-semibold mb-4">üèÄ Ko≈°arka≈°ke Tekme üèÄ</h1>

<form method="get" class="d-flex justify-content-center mb-3">
    <div style="max-width: 360px;" class="w-100">
        <select name="League" class="form-select" onchange="this.form.submit()">
            <option value="">Vse lige</option>
            @foreach (var l in Model.LeagueOptions)
            {
                <option value="@l" selected="@(Model.League == l)">
                    @l
                </option>
            }
        </select>
    </div>
</form>

@if (TempData["StatusMessage"] != null)
{
    <div class="alert alert-info text-center">
        @TempData["StatusMessage"]
    </div>
}

<table class="table table-striped mt-4 align-middle">
    <thead class="table-dark">
        <tr>
            <th style="width:16%;">Liga</th>
            <th style="width:16%;">Datum / Ura</th>
            <th style="width:34%;">Tekma</th>
            <th style="width:10%;" class="text-center">Rezultat</th>
            <th style="width:10%;" class="text-center">Znesek (‚Ç¨)</th>
            <th style="width:7%;" class="text-center">1</th>
            <th style="width:7%;" class="text-center">2</th>
        </tr>
    </thead>

    <tbody>
    @foreach (var g in Model.UpcomingGames)
    {
        // ‚Äúfake‚Äù kvote ‚Äì isto kot pri nogometu
        Random rnd = new Random(g.Id);
        decimal oddHome = (decimal)(rnd.NextDouble() * (2.5 - 1.2) + 1.2);
        decimal oddAway = (decimal)(rnd.NextDouble() * (2.5 - 1.2) + 1.2);

        <tr>
            <td><strong>@g.League.Name</strong></td>

            <td>@g.Date.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>

            <td>
                <strong>@g.Teams.Home.Name</strong> vs
                <strong>@g.Teams.Away.Name</strong>
            </td>

            <td class="text-center">
                @(g.Scores.Home.Total.HasValue && g.Scores.Away.Total.HasValue
                    ? $"{g.Scores.Home.Total} : {g.Scores.Away.Total}"
                    : "-")
            </td>

            @* ‚úÖ one form per row, but now each column has its own <td> *@
            <form method="post" asp-page-handler="PlaceBet">
                <input type="hidden" name="matchId" value="@g.Id" />
                <input type="hidden" name="homeTeam" value="@g.Teams.Home.Name" />
                <input type="hidden" name="awayTeam" value="@g.Teams.Away.Name" />

                <td class="text-center">
                    <input type="number"
                        name="stake"
                        class="form-control form-control-sm text-center"
                        value="0" min="1" style="width:80px; margin:auto;" />
                </td>

                <td class="text-center">
                    <button type="submit"
                            class="btn btn-sm btn-outline-primary w-100"
                            name="selectedOutcome"
                            value="1">
                        <input type="hidden" name="oddValue" value="@oddHome" />
                        @oddHome.ToString("F2")
                    </button>
                </td>

                <td class="text-center">
                    <button type="submit"
                            class="btn btn-sm btn-outline-danger w-100"
                            name="selectedOutcome"
                            value="2">
                        <input type="hidden" name="oddValue" value="@oddAway" />
                        @oddAway.ToString("F2")
                    </button>
                </td>
            </form>
        </tr>

    }
    </tbody>
</table>

<script>
    function setBasketBet(matchId, outcome, odd) {
        document.getElementById('outcome-' + matchId).value = outcome;
        document.getElementById('odd-' + matchId).value = odd;
    }
</script>
