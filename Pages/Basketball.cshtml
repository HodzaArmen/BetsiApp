@page
@model BetsiApp.Pages.BasketballModel

<h1 class="text-center mt-3">Prihajajoƒçe Ko≈°arka≈°ke Tekme üèÄ</h1>

@if (TempData["StatusMessage"] != null)
{
    <div class="alert alert-info text-center">
        @TempData["StatusMessage"]
    </div>
}

<table class="table table-striped mt-4 align-middle">
    <thead class="table-dark">
        <tr>
            <th>Liga</th>
            <th>Datum/Ura</th>
            <th>Tekma</th>
            <th>Rezultat</th>
            <th>Znesek (‚Ç¨)</th>
            <th class="text-center">1</th>
            <th class="text-center">2</th>
        </tr>
    </thead>

    <tbody>
    @foreach (var g in Model.UpcomingGames)
    {
        // ‚Äúfake‚Äù kvote ‚Äì isto kot pri nogometu
        Random rnd = new Random(g.Id);
        decimal oddHome = (decimal)(rnd.NextDouble() * (2.5 - 1.2) + 1.2);
        decimal oddAway = (decimal)(rnd.NextDouble() * (2.5 - 1.2) + 1.2);

        <tr>
            <td><strong>@g.League.Name</strong></td>

            <td>@g.Date.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>

            <td>
                <strong>@g.Teams.Home.Name</strong> vs
                <strong>@g.Teams.Away.Name</strong>
            </td>

            <td>
                @(g.Scores.Home.Total.HasValue && g.Scores.Away.Total.HasValue
                    ? $"{g.Scores.Home.Total} : {g.Scores.Away.Total}"
                    : "-")
            </td>

            <!-- ZNESEK -->

            <td>
                <form method="post" asp-page-handler="PlaceBet" class="d-flex gap-1">

                    <input type="hidden" name="matchId" value="@g.Id" />
                    <input type="hidden" name="homeTeam" value="@g.Teams.Home.Name" />
                    <input type="hidden" name="awayTeam" value="@g.Teams.Away.Name" />

                    <input type="number"
                        name="stake"
                        class="form-control form-control-sm"
                        value="10" min="1" style="width:70px;" />

                    <!-- HOME -->
                    <button type="submit"
                            name="selectedOutcome"
                            value="1"
                            formaction="?handler=PlaceBet"
                            class="btn btn-outline-primary">
                        <input type="hidden" name="oddValue" value="@oddHome" />
                        @oddHome.ToString("F2")
                    </button>

                    <!-- AWAY -->
                    <button type="submit"
                            name="selectedOutcome"
                            value="2"
                            formaction="?handler=PlaceBet"
                            class="btn btn-outline-danger">
                        <input type="hidden" name="oddValue" value="@oddAway" />
                        @oddAway.ToString("F2")
                    </button>
                </form>
            </td>


        </tr>
    }
    </tbody>
</table>

<script>
    function setBasketBet(matchId, outcome, odd) {
        document.getElementById('outcome-' + matchId).value = outcome;
        document.getElementById('odd-' + matchId).value = odd;
    }
</script>
