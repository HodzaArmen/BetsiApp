@page
@model BetsiApp.Pages.TransactionsModel

<h1 class="text-center mt-6 fw-semibold">Transakcije</h1>

<div class="text-center">
    <span class="fw-bold fs-5">Trenutno stanje:</span>
    <span class="fw-bold fs-5 @(Model.Balance > 0 ? "text-success" : "text-danger")">
        @Model.Balance.ToString("F2") €
    </span>
</div>

<div class="d-flex justify-content-center mt-4">
    <div style="width: 260px;">

        <div class="d-flex align-items-center mb-2">
            <input id="amountInput"
                type="number"
                step="0.01"
                min="0.01"
                inputmode="decimal"
                placeholder="Vnesite znesek"
                class="form-control" />

            @if (!string.IsNullOrWhiteSpace(Model.InlineError))
            {
                <span class="text-danger ms-2 small">
                    @Model.InlineError
                </span>
            }
        </div>

        <!-- Add money -->
        <form id="addMoneyForm" method="post" asp-page-handler="AddMoney">
            <button type="submit" class="btn btn-primary w-100 mb-2">
                Dodaj denar
            </button>
        </form>

        <!-- Withdraw money -->
        <form id="withdrawForm" method="post" asp-page-handler="Withdraw">
            <button type="submit" class="btn btn-danger w-100">
                Dvigni denar
            </button>
        </form>
    </div>
</div>


<script>
    document.getElementById('addMoneyForm').addEventListener('submit', function () {
        addHiddenAmount(this);
    });

    document.getElementById('withdrawForm').addEventListener('submit', function () {
        addHiddenAmount(this);
    });

    function addHiddenAmount(form) {
    const existing = form.querySelector('input[name="Amount"]');
    if (existing) existing.remove();

    let amount = document.getElementById('amountInput').value;

    amount = amount.replace(',', '.');

    const hidden = document.createElement('input');
    hidden.type = 'hidden';
    hidden.name = 'Amount';
    hidden.value = amount;
    form.appendChild(hidden);
}
</script>

@if (Model.History.Any())
{
    <h3 id="transactionsHistory" class="mt-4">
        @(Model.ShowAll ? "Vse transakcije" : "Transakcije")
    </h3>

    <ul class="list-unstyled">
        @foreach (var item in Model.History)
        {
            if (item.Type == "Deposit")
            {
                <li class="alert alert-primary">
                    + @item.Amount.ToString("F2") € (polog)
                    <br />
                    <small>@item.Date.ToString("dd.MM.yyyy HH:mm")</small>
                </li>
            }
            else if (item.Type == "Withdraw")
            {
                <li class="alert alert-warning">
                    - @item.Amount.ToString("F2") € (dvig)
                    <br />
                    <small>@item.Date.ToString("dd.MM.yyyy HH:mm")</small>
                </li>
            }
        }
    </ul>

    @if (!Model.ShowAll)
    {
        <div class="text-center mt-3">
            <form method="post" asp-page-handler="ShowAll" asp-fragment="transactionsHistory">
                <button type="submit" class="btn btn-outline-secondary">
                    Pokaži vse transakcije
                </button>
            </form>
        </div>
    }
}